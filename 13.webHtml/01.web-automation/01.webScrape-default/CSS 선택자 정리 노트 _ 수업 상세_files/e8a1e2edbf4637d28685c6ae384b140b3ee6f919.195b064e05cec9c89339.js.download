(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[68],{EWj0:function(t,e,n){t.exports=n("ugx8").version},Z4fQ:function(t,e){var n=function(){if("object"===typeof self&&self)return self;if("object"===typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};t.exports=function(){if(this)return this;if("object"===typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(t){return n()}try{return __global__||n()}finally{delete Object.prototype.__global__}}()},d71D:function(t,e,n){"use strict";var i,o,r,a,c,s,u,f,l,b,p,h,d,j,O,g,w,y,m=n("KQm4"),k=n("o0o1"),v=n.n(k),N=n("HaE+"),x=n("a3ss"),C=n("1OyB"),E=n("vuIU"),L=n("Y65e"),z=(n("+JCI"),n("2vnA")),I=n("vDqi"),_=n.n(I),A=n("/yzB"),T=n("cBaE"),S=n("fjyx"),q=n.n(S),W=(y=w=function(){function t(){Object(C.a)(this,t),Object(x.a)(this,"socket",o,this),Object(x.a)(this,"isLoading",r,this),Object(x.a)(this,"notificationList",a,this),Object(x.a)(this,"isError",c,this),Object(x.a)(this,"isEnd",s,this),Object(x.a)(this,"isInit",u,this),Object(x.a)(this,"offset",f,this),Object(x.a)(this,"count",l,this),Object(x.a)(this,"connectSocket",b,this),Object(x.a)(this,"fetchNotification",p,this),Object(x.a)(this,"fetchCnt",h,this),Object(x.a)(this,"readItem",d,this),Object(x.a)(this,"deleteNotification",j,this),Object(x.a)(this,"deleteAll",O,this),Object(x.a)(this,"resetOption",g,this)}return Object(E.a)(t,[{key:"notificationCount",get:function(){return this.count}}],[{key:"getInstance",value:function(){return null===t.instance&&(t.instance=new t),t.instance}}]),t}(),w.instance=null,i=y,o=Object(L.a)(i.prototype,"socket",[z.o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r=Object(L.a)(i.prototype,"isLoading",[z.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),a=Object(L.a)(i.prototype,"notificationList",[z.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),c=Object(L.a)(i.prototype,"isError",[z.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),s=Object(L.a)(i.prototype,"isEnd",[z.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u=Object(L.a)(i.prototype,"isInit",[z.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),f=Object(L.a)(i.prototype,"offset",[z.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),l=Object(L.a)(i.prototype,"count",[z.o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),b=Object(L.a)(i.prototype,"connectSocket",[z.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(){t.socket=new q.a.w3cwebsocket("wss://api-release.codeit.kr/notifications"),t.socket.onopen=function(){Object(T.b)("connected")},t.socket.onmessage=function(t){Object(T.b)("connectSocket onmessage",t)},t.socket.onclose=function(t){Object(T.b)("connectSocket onclose",t),Object(T.b)("disconnected")}}}}),p=Object(L.a)(i.prototype,"fetchNotification",[z.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return Object(N.a)(v.a.mark((function e(){var n,i,o,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.isLoading||t.isError||t.isEnd)){e.next=2;break}return e.abrupt("return");case 2:return t.isLoading=!0,e.prev=3,e.next=6,_()({method:"post",url:"https://api.codeit.kr/graphql",headers:{"Content-Type":"application/graphql",Authorization:"Bearer "+Object(T.j)("cat")},data:"\n          {\n            notificationsWithOffset(offset: "+t.offset+", limit: 10, includeRead: false) {\n              "+A.a.NOTIFICATION_ATTR()+"\n            }\n            unreadNotificationsCount\n          }\n        "});case 6:n=e.sent,i=!!n.data.errors.length,o=!!n.data.data.notificationsWithOffset.length,r=!!n.data.data.unreadNotificationsCount,!i||o||r?setTimeout((function(){Object(z.p)((function(){t.isLoading=!1,t.notificationList=t.notificationList.concat(n.data.data.notificationsWithOffset),t.offset+=t.notificationList.length,t.count=n.data.data.unreadNotificationsCount,t.isInit||(t.isInit=!0)}))}),800):Object(z.p)((function(){t.isError=!0})),n.data.data.notificationsWithOffset.length<10&&Object(z.p)((function(){t.isEnd=!0})),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),Object(z.p)((function(){t.isError=!0}));case 17:case"end":return e.stop()}}),e,null,[[3,14]])})))}}),h=Object(L.a)(i.prototype,"fetchCnt",[z.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return Object(N.a)(v.a.mark((function e(){var n,i,o;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_()({method:"post",url:"https://api.codeit.kr/graphql",headers:{"Content-Type":"application/graphql",Authorization:"Bearer "+Object(T.j)("cat")},data:"\n          {\n            unreadNotificationsCount\n          }\n        "});case 3:n=e.sent,i=!!n.data.errors.length,o=!!n.data.data.unreadNotificationsCount,i&&!o?Object(z.p)((function(){t.isError=!0})):Object(z.p)((function(){t.count=n.data.data.unreadNotificationsCount})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),Object(z.p)((function(){t.isError=!0}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))}}),d=Object(L.a)(i.prototype,"readItem",[z.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(){var e=Object(N.a)(v.a.mark((function e(n){var i;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(i=t.notificationList.find((function(t){return t.id===n})))){e.next=5;break}if(!i.read){e.next=4;break}return e.abrupt("return");case 4:Object(z.p)((function(){i.read=!0,t.count-=1,t.notificationList=Object(m.a)(t.notificationList)}));case 5:return e.next=7,_()({method:"post",url:"https://api.codeit.kr/graphql",headers:{"Content-Type":"application/graphql",Authorization:"Bearer "+Object(T.j)("cat")},data:'\n        mutation {\n          readNotification(id: "'+n+'") {\n            id\n          }\n        }\n      '}).then((function(t){Object(T.b)("readItem res",t)})).catch((function(t){Object(T.b)("readItem err",t)}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}),j=Object(L.a)(i.prototype,"deleteNotification",[z.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(){var e=Object(N.a)(v.a.mark((function e(n){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_()({method:"post",url:"https://api.codeit.kr/graphql",headers:{"Content-Type":"application/graphql",Authorization:"Bearer "+Object(T.j)("cat")},data:'\n        mutation {\n          deleteNotification(id: "'+n+'") {\n            id\n          }\n        }\n      '}).then((function(t){Object(T.b)("deleteNotification res",t)})).catch((function(t){Object(T.b)("deleteNotification err",t)})).finally((function(){Object(z.p)((function(){var e=t.notificationList.find((function(t){return t.id===n}));void 0===e||e.read||(t.count-=1,t.offset-=1),t.notificationList=t.notificationList.filter((function(t){return t.id!==n})),0!==t.count&&0===t.notificationList.length&&t.fetchNotification()}))}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}),O=Object(L.a)(i.prototype,"deleteAll",[z.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return Object(N.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.notificationList.length){e.next=3;break}return e.next=3,_()({method:"post",url:"https://api.codeit.kr/graphql",headers:{"Content-Type":"application/graphql",Authorization:"Bearer "+Object(T.j)("cat")},data:"\n          mutation {\n            deleteAllNotifications {\n              id\n            }\n          }\n        "}).then((function(t){Object(T.b)("deleteAll res",t)})).catch((function(t){Object(T.b)("deleteAll err",t)})).finally((function(){Object(z.p)((function(){t.notificationList=[],t.count=0}))}));case 3:case"end":return e.stop()}}),e)})))}}),g=Object(L.a)(i.prototype,"resetOption",[z.f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(){t.isInit=!1,t.notificationList=[],t.isError=!1,t.isLoading=!1,t.offset=0,t.isEnd=!1}}}),Object(L.a)(i.prototype,"notificationCount",[z.g],Object.getOwnPropertyDescriptor(i.prototype,"notificationCount"),i.prototype),i);e.a=W},fjyx:function(t,e,n){var i;try{i=n("Z4fQ")}catch(c){}finally{if(i||"undefined"===typeof window||(i=window),!i)throw new Error("Could not determine global this")}var o=i.WebSocket||i.MozWebSocket,r=n("EWj0");function a(t,e){return e?new o(t,e):new o(t)}o&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(t){Object.defineProperty(a,t,{get:function(){return o[t]}})})),t.exports={w3cwebsocket:o?a:null,version:r}},ugx8:function(t){t.exports=JSON.parse('{"name":"websocket","description":"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.","keywords":["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],"author":"Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)","contributors":["I\xf1aki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],"version":"1.0.32","repository":{"type":"git","url":"https://github.com/theturtle32/WebSocket-Node.git"},"homepage":"https://github.com/theturtle32/WebSocket-Node","engines":{"node":">=4.0.0"},"dependencies":{"bufferutil":"^4.0.1","debug":"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2","yaeti":"^0.0.6"},"devDependencies":{"buffer-equal":"^1.0.0","gulp":"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1","jshint":"^2.0.0","tape":"^4.9.1"},"config":{"verbose":false},"scripts":{"test":"tape test/unit/*.js","gulp":"gulp"},"main":"index","directories":{"lib":"./lib"},"browser":"lib/browser.js","license":"Apache-2.0"}')}}]);